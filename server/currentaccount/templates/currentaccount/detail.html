<style>
  #chat_box {
    width: 90%;
    margin: 10px;
    padding: 10px;
    min-height: 300px;
    background: rgb(232,232,232);
  }
  #chat_input {
    margin: 10px;
    width: 90%;
  }
</style>

<div id='chat_box'></div>
<form id="chat_form">
  <input type="text" id='chat_input'/> 
  <input type="submit" val='send' id='send'/> 
</form>


<script src="http://ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js"></script>

<script src="http://cdn.pubnub.com/pubnub-3.1.min.js"></script>
<script src="http://pubnub.github.com/pubnub-api/crypto/crypto.js"></script>
<script src="http://pubnub.github.com/pubnub-api/crypto/encrypt-pubnub.js"></script>

<script>
(function()
{

// Create Secure Connection
var secure_pubnub = PUBNUB.secure({
    publish_key   : "{{ publish_key }}",
    subscribe_key : "{{ subscribe_key }}",
    origin        : "pubsub.pubnub.com",
    ssl           : true,
    cipher_key    : "{{ chipher_key }}"
});

// Secure Connection
secure_pubnub.subscribe({
    channel    : "{{ private_update_channel }}", 
    callback   : function(message) {
    if (message.name) {
        PUBNUB.events.fire(message.name, message.data);
    }
  }
});

    return false;
});

// Update Display (DOM)
PUBNUB.events.bind('secure_chat_message', function(data) {
    $('#chat_box').append("<p>" + data.message + "</p>");
});

})();
 </script>
